<!DOCTYPE html>
<html>
<head>
    <title>URL Builder Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #007bff; }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #dee2e6;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            border-radius: 4px;
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó URL Builder Test</h1>
        <p>This page tests the URL building function to prevent double slashes.</p>
        
        <div id="config-info">
            <h2>Configuration Info</h2>
            <p>API Base URL: <strong id="api-base-url">Not loaded yet</strong></p>
        </div>
        
        <button id="run-test">Run URL Tests</button>
        
        <div id="test-results"></div>
    </div>

    <script>
        // Get API base URL from environment
        const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000';
        document.getElementById('api-base-url').textContent = API_BASE_URL;
        
        // Safe URL builder function (same as in api.ts)
        function buildApiUrl(base, endpoint) {
            // Remove trailing slash from base URL if present
            const cleanBase = base.endsWith('/') ? base.slice(0, -1) : base;
            // Remove leading slash from endpoint if present
            const cleanEndpoint = endpoint.startsWith('/') ? endpoint.slice(1) : endpoint;
            // Combine with single slash
            return `${cleanBase}/${cleanEndpoint}`;
        }
        
        document.getElementById('run-test').addEventListener('click', runTests);
        
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Running tests...</p>';
            
            // Test cases
            const testCases = [
                {
                    name: "Base without slash, endpoint without slash",
                    base: "https://careerpath-production-fd70.up.railway.app",
                    endpoint: "api/videos",
                    expected: "https://careerpath-production-fd70.up.railway.app/api/videos"
                },
                {
                    name: "Base with slash, endpoint without slash",
                    base: "https://careerpath-production-fd70.up.railway.app/",
                    endpoint: "api/videos",
                    expected: "https://careerpath-production-fd70.up.railway.app/api/videos"
                },
                {
                    name: "Base without slash, endpoint with slash",
                    base: "https://careerpath-production-fd70.up.railway.app",
                    endpoint: "/api/videos",
                    expected: "https://careerpath-production-fd70.up.railway.app/api/videos"
                },
                {
                    name: "Base with slash, endpoint with slash",
                    base: "https://careerpath-production-fd70.up.railway.app/",
                    endpoint: "/api/videos",
                    expected: "https://careerpath-production-fd70.up.railway.app/api/videos"
                }
            ];
            
            let allPassed = true;
            let resultsHTML = '<h2>Test Results</h2>';
            
            testCases.forEach((testCase, index) => {
                const result = buildApiUrl(testCase.base, testCase.endpoint);
                const passed = result === testCase.expected;
                allPassed = allPassed && passed;
                
                resultsHTML += `
                    <div class="test-case">
                        <h3>Test ${index + 1}: ${testCase.name}</h3>
                        <p><strong>Base:</strong> ${testCase.base}</p>
                        <p><strong>Endpoint:</strong> ${testCase.endpoint}</p>
                        <p><strong>Result:</strong> ${result}</p>
                        <p><strong>Expected:</strong> ${testCase.expected}</p>
                        <p class="${passed ? 'success' : 'error'}">${passed ? '‚úÖ PASSED' : '‚ùå FAILED'}</p>
                    </div>
                `;
            });
            
            resultsHTML += `
                <div style="margin-top: 20px; padding: 15px; border-radius: 4px; ${allPassed ? 'background-color: #d4edda; border: 1px solid #c3e6cb;' : 'background-color: #f8d7da; border: 1px solid #f5c6cb;'}">
                    <h3>Overall Result: ${allPassed ? '‚úÖ ALL TESTS PASSED' : '‚ùå SOME TESTS FAILED'}</h3>
                    <p>${allPassed ? 'The URL builder function correctly prevents double slashes.' : 'The URL builder function has issues with double slashes.'}</p>
                </div>
            `;
            
            resultsDiv.innerHTML = resultsHTML;
        }
        
        // Run tests automatically when page loads
        window.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>